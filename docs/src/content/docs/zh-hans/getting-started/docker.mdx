---
title: å®˜æ–¹ Docker é•œåƒ
---

Castopod åœ¨å…¶è‡ªåŠ¨æ„å»ºæœŸé—´ä¼šå°† 3 ä¸ª Docker æ˜ åƒæ¨é€åˆ° Docker Hub ï¼š

- [**`castopod/castopod`**](https://hub.docker.com/r/castopod/castopod)ï¼›ä¸€ä¸ªä½¿
  ç”¨ nginx å•å…ƒçš„æ•´åˆ Castopod é•œåƒ
- [**`castopod/app`**](https://hub.docker.com/r/castopod/app)ï¼šåº”ç”¨ç¨‹åºåŒ…ï¼ŒåŒ…å«
  æ‰€æœ‰ Castopod ä¾èµ–å…³ç³»
- [**`castopod/web-server`**](https://hub.docker.com/r/castopod/web-server)ï¼šCastopod
  çš„ Nginx é…ç½®

æ­¤å¤–ï¼ŒCastopod éœ€è¦ä¸€ä¸ªä¸ MySQL å…¼å®¹çš„æ•°æ®åº“ã€‚ Redis æ•°æ®åº“ å¯ä»¥æ·»åŠ ä¸ºç¼“å­˜å¤„ç†
å™¨ã€‚

## ç›®å‰æ”¯æŒçš„æ ‡ç­¾

- `develop` [unstable], æœ€æ–°å¼€å‘åˆ†æ”¯ç‰ˆæœ¬
- `beta` [stable]ï¼Œæœ€æ–°çš„ beta ç‰ˆæœ¬æ„å»º
- `latest` [stable]ï¼Œæœ€æ–°ç‰ˆæœ¬æ„å»º
- `1.x.x` [stable]ï¼Œç‰¹å®šç‰ˆæœ¬æ„å»ºï¼ˆè‡ª `1.0.0` èµ·ï¼‰

## ç”¨æ³•ç¤ºä¾‹ï¼š

1.  å®‰è£… [Docker](https://docs.docker.com/get-docker/) å’Œ
    [docker-compose](https://docs.docker.com/compose/install/)
2.  åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

    ```yml
    version: "3.7"

    services:
      app:
        image: castopod/castopod:latest
        container_name: "castopod-app"
        volumes:
          - castopod-media:/var/www/castopod/public/media
        environment:
          MYSQL_DATABASE: castopod
          MYSQL_USER: castopod
          MYSQL_PASSWORD: changeme
          CP_BASEURL: "https://castopod.example.com"
          CP_ANALYTICS_SALT: changeme
          CP_CACHE_HANDLER: redis
          CP_REDIS_HOST: redis
          CP_REDIS_PASSWORD: changeme
        networks:
          - castopod-app
          - castopod-db
        ports:
          - 8000:8000
        restart: unless-stopped

      mariadb:
        image: mariadb:10.5
        container_name: "castopod-mariadb"
        networks:
          - castopod-db
        volumes:
          - castopod-db:/var/lib/mysql
        environment:
          MYSQL_ROOT_PASSWORD: changeme
          MYSQL_DATABASE: castopod
          MYSQL_USER: castopod
          MYSQL_PASSWORD: changeme
        restart: unless-stopped

      redis:
        image: redis:7.0-alpine
        container_name: "castopod-redis"
        command: --requirepass changeme
        volumes:
          - castopod-cache:/data
        networks:
          - castopod-app

    volumes:
      castopod-media:
      castopod-db:
      castopod-cache:

    networks:
      castopod-app:
      castopod-db:
    ```

    ä½ è¿˜éœ€è¦è°ƒæ•´ä¸€äº›å˜é‡ã€‚ ï¼ˆä¾‹å¦‚ï¼š`CP_BASEURL`ï¼Œ `MYSQL_ROOT_PASSWORD`ï¼Œ
    `MYSQL_PASSSWORD` å’Œ `CP_ANALYTICS_SALT`ï¼‰

3.  è®¾ç½® TLS åå‘ä»£ç† (SSL/HTTPS)

    TLS æ˜¯ ActivePub å·¥ä½œçš„å¼ºåˆ¶æ€§è¦æ±‚ã€‚ æ­¤æ“ä½œå¯ç”¨é€šè¿‡åå‘ä»£ç†è½»æ¾è§£å†³ï¼Œä¾‹å¦‚ä½¿ç”¨
    [Caddy](https://caddyserver.com/) å¤„ç†ï¼š

    ```
    #castopod
    castopod.example.com {
        reverse_proxy localhost:8000
    }
    ```

4.  è¿è¡Œå‘½ä»¤ `docker-compose up -d`ï¼Œ ç­‰å¾…åˆå§‹åŒ–åè·³è½¬åˆ°
    `https://castopod.example.com/cp-install` æ¥å®Œæˆ Castopod çš„è®¾ç½®ï¼

5.  ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œå¼€å§‹åšå®¢å§ï¼ ğŸ™ï¸ğŸš€

## ç¯å¢ƒå˜é‡

- **castopod/castopod** å’Œ **castopod/app**

  | å˜é‡åç§°                              | ç±»å‹ (`é»˜è®¤å€¼`)         | Default          |
  | ------------------------------------- | ----------------------- | ---------------- |
  | **`CP_BASEURL`**                      | string                  | `undefined`      |
  | **`CP_MEDIA_BASEURL`**                | ?string                 | `CP_BASEURL`     |
  | **`CP_ADMIN_GATEWAY`**                | ?string                 | `"cp-admin"`     |
  | **`CP_AUTH_GATEWAY`**                 | ?string                 | `"cp-auth"`      |
  | **`CP_ANALYTICS_SALT`**               | string                  | `undefined`      |
  | **`CP_DATABASE_HOSTNAME`**            | ?string                 | `"mariadb"`      |
  | **`CP_DATABASE_NAME`**                | ?string                 | `MYSQL_DATABASE` |
  | **`CP_DATABASE_USERNAME`**            | ?string                 | `MYSQL_USER`     |
  | **`CP_DATABASE_PASSWORD`**            | ?string                 | `MYSQL_PASSWORD` |
  | **`CP_DATABASE_PREFIX`**              | ?string                 | `"cp_"`          |
  | **`CP_CACHE_HANDLER`**                | [`"file"` æˆ– `"redis"`] | `"file"`         |
  | **`CP_REDIS_HOST`**                   | ?string                 | `"localhost"`    |
  | **`CP_REDIS_PASSWORD`**               | ?string                 | `null`           |
  | **`CP_REDIS_PORT`**                   | ?number                 | `6379`           |
  | **`CP_REDIS_DATABASE`**               | ?number                 | `0`              |
  | **`CP_EMAIL_SMTP_HOST`**              | ?string                 | `undefined`      |
  | **`CP_EMAIL_FROM`**                   | ?string                 | `undefined`      |
  | **`CP_EMAIL_SMTP_USERNAME`**          | ?string                 | `"localhost"`    |
  | **`CP_EMAIL_SMTP_PASSWORD`**          | ?string                 | `null`           |
  | **`CP_EMAIL_SMTP_PORT`**              | ?number                 | `25`             |
  | **`CP_EMAIL_SMTP_CRYPTO`**            | [`"tls"` æˆ– `"ssl"`]    | `"tls"`          |
  | **`CP_ENABLE_2FA`**                   | ?boolean                | `undefined`      |
  | **`CP_MEDIA_FILE_MANAGER`**           | ?string                 | `undefined`      |
  | **`CP_MEDIA_S3_ENDPOINT`**            | ?string                 | `undefined`      |
  | **`CP_MEDIA_S3_KEY`**                 | ?string                 | `undefined`      |
  | **`CP_MEDIA_S3_SECRET`**              | ?string                 | `undefined`      |
  | **`CP_MEDIA_S3_REGION`**              | ?string                 | `undefined`      |
  | **`CP_MEDIA_S3_BUCKET`**              | ?string                 | `undefined`      |
  | **`CP_MEDIA_S3_PROTOCOL`**            | ?number                 | `undefined`      |
  | **`CP_MEDIA_S3_PATH_STYLE_ENDPOINT`** | ?boolean                | `undefined`      |
  | **`CP_MEDIA_S3_KEY_PREFIX`**          | ?string                 | `undefined`      |
  | **`CP_DISABLE_HTTPS`**                | ?[`0` or `1`]           | `undefined`      |
  | **`CP_MAX_BODY_SIZE`**                | ?number (with suffix)   | `512M`           |
  | **`CP_PHP_MEMORY_LIMIT`**             | ?number (with suffix)   | `512M`           |
  | **`CP_TIMEOUT`**                      | ?number                 | `900`            |

- **castopod/web-server**

  | å˜é‡åç§°               | Type                  | Default |
  | ---------------------- | --------------------- | ------- |
  | **`CP_APP_HOSTNAME`**  | ?string               | `"app"` |
  | **`CP_MAX_BODY_SIZE`** | ?number (with suffix) | `512M`  |
  | **`CP_TIMEOUT`**       | ?number               | `900`   |
