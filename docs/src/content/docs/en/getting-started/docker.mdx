---
title: Official Docker image
---

import { Aside } from "@astrojs/starlight/components";

Castopod publishes a single official Docker image to the Docker Hub as part of
its automated build process:

- [**`castopod/castopod`**](https://hub.docker.com/r/castopod/castopod): an
  all-in-one image integrating [FrankenPHP](https://frankenphp.dev/) and
  [Caddy](https://caddyserver.com/), optimized for production environments. It
  is based on
  [serversideup/php](https://serversideup.net/open-source/docker-php/docs/image-variations/frankenphp).

Castopod requires a MySQL-compatible database to function. Optionally, a Redis
service can be configured as the caching layer.

## Supported tags

- `1.x.x`, specific version build (since `1.0.0`)
- `1`, latest build for version 1
- `latest`, latest version build
- `develop` [unstable], latest development branch build

Other unstable channels (e.g., `beta`, `next`, `2-next`) may be actively pushed
during development phases. See
[all tags in the docker hub](https://hub.docker.com/r/castopod/castopod/tags).

<Aside type="caution">
  For production stability, prefer specific tags like `1.x.x` (e.g., `1.15.1`)
  over generic channels (e.g., `latest`, `1`).
  <br />
  Generic tags change unexpectedly, risking downtime and inconsistent
  deployments.
</Aside>

## Example usage

1.  Install [docker](https://docs.docker.com/get-docker/) and
    [docker compose](https://docs.docker.com/compose/install/)
2.  Create a `compose.yml` file with the following:

    ```yml
    services:
      castopod:
        image: castopod/castopod:1 # Pin to a specific version during production
        container_name: "castopod"
        volumes:
          - castopod-media:/app/public/media
        environment:
          MYSQL_DATABASE: castopod
          MYSQL_USER: castopod
          MYSQL_PASSWORD: changeme
          CP_BASEURL: "https://castopod.example.com"
          CP_ANALYTICS_SALT: changeme
          CP_CACHE_HANDLER: redis
          CP_REDIS_HOST: redis
          CP_REDIS_PASSWORD: changeme
        networks:
          - castopod-app
          - castopod-db
        ports:
          - "8080:8080" # HTTP
          - "8443:8443" # HTTPS
          - "8443:8443/udp" # HTTP/3
        restart: unless-stopped
        healthcheck:
          test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
          interval: 30s
          timeout: 10s
          retries: 3
          start_period: 30s # allows bootstrap/migrations time
        depends_on:
          mariadb:
            condition: service_healthy
            restart: true
          redis:
            condition: service_started

      mariadb:
        image: mariadb:12.1
        container_name: "castopod-mariadb"
        networks:
          - castopod-db
        volumes:
          - castopod-db:/var/lib/mysql
        environment:
          MYSQL_ROOT_PASSWORD: changeme
          MYSQL_DATABASE: castopod
          MYSQL_USER: castopod
          MYSQL_PASSWORD: changeme
        restart: unless-stopped
        healthcheck:
          test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
          start_period: 10s
          interval: 10s
          timeout: 5s
          retries: 3

      redis:
        image: redis:8.4-alpine
        container_name: "castopod-redis"
        command: --requirepass changeme
        volumes:
          - castopod-cache:/data
        networks:
          - castopod-app

    volumes:
      castopod-media:
      castopod-db:
      castopod-cache:

    networks:
      castopod-app:
      castopod-db:
        internal: true
    ```

    You have to adapt some variables to your needs (e.g. `CP_BASEURL`,
    `MYSQL_ROOT_PASSWORD`, `MYSQL_PASSWORD` and `CP_ANALYTICS_SALT`).

3.  Setup a reverse proxy for TLS (SSL/HTTPS)

    TLS is mandatory for ActivityPub to work. This job can easily be handled by
    a reverse proxy, for example with [Caddy](https://caddyserver.com/):

    ```
    #castopod
    castopod.example.com {
    	reverse_proxy localhost:8080
    }
    ```

4.  Run `docker compose up -d`, wait for it to initialize and head on to
    `https://castopod.example.com/cp-install` to finish setting up Castopod!

5.  You're all set, start podcasting! üéôÔ∏èüöÄ

## Environment Variables

| Variable name                         | Type (`default`)        | Default          |
| ------------------------------------- | ----------------------- | ---------------- |
| **`CP_BASEURL`**                      | string                  | `undefined`      |
| **`CP_MEDIA_BASEURL`**                | ?string                 | `CP_BASEURL`     |
| **`CP_ADMIN_GATEWAY`**                | ?string                 | `"cp-admin"`     |
| **`CP_AUTH_GATEWAY`**                 | ?string                 | `"cp-auth"`      |
| **`CP_ANALYTICS_SALT`**               | string                  | `undefined`      |
| **`CP_DATABASE_HOSTNAME`**            | ?string                 | `"mariadb"`      |
| **`CP_DATABASE_NAME`**                | ?string                 | `MYSQL_DATABASE` |
| **`CP_DATABASE_USERNAME`**            | ?string                 | `MYSQL_USER`     |
| **`CP_DATABASE_PASSWORD`**            | ?string                 | `MYSQL_PASSWORD` |
| **`CP_DATABASE_PREFIX`**              | ?string                 | `"cp_"`          |
| **`CP_CACHE_HANDLER`**                | [`"file"` or `"redis"`] | `"file"`         |
| **`CP_REDIS_HOST`**                   | ?string                 | `"localhost"`    |
| **`CP_REDIS_PASSWORD`**               | ?string                 | `null`           |
| **`CP_REDIS_PORT`**                   | ?number                 | `6379`           |
| **`CP_REDIS_DATABASE`**               | ?number                 | `0`              |
| **`CP_EMAIL_SMTP_HOST`**              | ?string                 | `undefined`      |
| **`CP_EMAIL_FROM`**                   | ?string                 | `undefined`      |
| **`CP_EMAIL_SMTP_USERNAME`**          | ?string                 | `"localhost"`    |
| **`CP_EMAIL_SMTP_PASSWORD`**          | ?string                 | `null`           |
| **`CP_EMAIL_SMTP_PORT`**              | ?number                 | `25`             |
| **`CP_EMAIL_SMTP_CRYPTO`**            | [`"tls"` or `"ssl"`]    | `"tls"`          |
| **`CP_ENABLE_2FA`**                   | ?boolean                | `undefined`      |
| **`CP_MEDIA_FILE_MANAGER`**           | ?string                 | `undefined`      |
| **`CP_MEDIA_S3_ENDPOINT`**            | ?string                 | `undefined`      |
| **`CP_MEDIA_S3_KEY`**                 | ?string                 | `undefined`      |
| **`CP_MEDIA_S3_SECRET`**              | ?string                 | `undefined`      |
| **`CP_MEDIA_S3_REGION`**              | ?string                 | `undefined`      |
| **`CP_MEDIA_S3_BUCKET`**              | ?string                 | `undefined`      |
| **`CP_MEDIA_S3_PROTOCOL`**            | ?number                 | `undefined`      |
| **`CP_MEDIA_S3_PATH_STYLE_ENDPOINT`** | ?boolean                | `undefined`      |
| **`CP_MEDIA_S3_KEY_PREFIX`**          | ?string                 | `undefined`      |
| **`CP_DISABLE_HTTPS`**                | ?[`0` or `1`]           | `undefined`      |
| **`PHP_MEMORY_LIMIT`**                | ?number (with suffix)   | `512M`           |
| **`PHP_UPLOAD_MAX_FILE_SIZE`**        | ?number (with suffix)   | `512M`           |
| **`PHP_POST_MAX_SIZE`**               | ?number (with suffix)   | `512M`           |
| **`PHP_MAX_EXECUTION_TIME`**          | ?number                 | `300`            |
| **`PHP_OPCACHE_ENABLE`**              | ?[`0` or `1`]           | `1`              |
